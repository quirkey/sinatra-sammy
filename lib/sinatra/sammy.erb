<%= jquery_js %>
<script type="text/javascript" charset="utf-8">
  <%= sammy_js %>
  (function($) {
    var app = $.sammy(function() { with(this) {

      <% @sammy_options.each do |option, value| %>
      this.<%= option %> = <%= value.inspect %>;
      <% end %>
      
      get(/\#(.*)$/, function() { with(this) {
        trigger('loading');
        partial(params['splat'] + '?_sammy=true');
      }});
      
      bind('changed', function() { with(this) {
        $('a').attr('href', function() {
          var href = $(this).attr('href');
          if (href.match(/^\//)) {
            return "#" + href;
          } else {
            return href;
          }
        });
      }});
      
    }});
    
    $(function() {
      app.run();
    });
  })(jQuery);
</script>